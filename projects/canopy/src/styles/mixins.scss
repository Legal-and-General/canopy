@use 'sass:map';

/* stylelint-disable nesting-selector-no-missing-scoping-root */
/*
  $bg-color: background color of the element.
  $color: colour of the outline.
  Sets the focus outline inside the element, by using multiple box shadows
*/
@mixin lg-inner-focus-outline(
  $bg-color: var(--default-focus-color),
  $color: var(--colour-greyscale-0)
) {
  outline: 0;
  box-shadow:
    inset 0 0 0 0.25rem $bg-color,
    inset 0 0 0 0.3rem $color;
}

@mixin lg-focus-outline(
  $bg-color: var(--default-focus-color),
  $inner-bg-color: var(--default-inner-focus-color)
) {
  outline: 0 !important;
  box-shadow:
    0 0 0 var(--inner-focus-width) $inner-bg-color,
    0 0 0 var(--outer-focus-width) $bg-color;
}

@mixin lg-link(
  $default-color: var(--link-primary-rest-colour),
  $hover-color: var(--link-primary-hover-colour),
  $visited-color: var(--link-primary-visited-colour),
  $active-color: var(--link-primary-active-colour),
  $focus-color: var(--link-primary-focus-colour),
  $focus-border-width: var(--link-primary-focus-border-width),
  $focus-border-radius: var(--link-primary-focus-border-radius),
  $icon-height: var(--dimensions-small-5),
  $icon-width: var(--dimensions-small-5)
) {
  $box-shadow-inset-width: -0.063rem;

  color: $default-color;
  line-height: initial;
  text-decoration-line: underline;
  text-decoration-style: solid;
  text-decoration-skip-ink: auto;
  text-decoration-thickness: 6%;
  text-underline-offset: 13%;
  text-underline-position: from-font;
  padding: 0 0.125rem;

  &:hover,
  &:hover:visited {
    color: $hover-color;
    text-decoration-thickness: 12%;
    text-underline-offset: 13%;
  }

  &:visited {
    color: $visited-color;
  }

  &:active {
    color: $active-color;
    outline: 0;
    text-decoration-thickness: 12%;
    text-underline-offset: 13%;
  }

  &:focus-visible,
  &:focus-visible:hover {
    border-bottom: 0;
    border-radius: $focus-border-radius;
    color: $focus-color;
    outline: $focus-border-width solid $focus-color;
    outline-offset: 0;
  }

  .lg-icon {
    height: $icon-height;
    width: $icon-width;
    display: inline-block;
    vertical-align: middle;
    text-decoration: none;
    margin-right: var(--link-gap);
  }

  .lg-icon[name='link-external'] {
    margin-right: 0;
    margin-left: var(--link-gap);
  }
}

@mixin lg-unstyled-link() {
  padding: 0;

  &:hover {
    border-bottom: 0;
    box-shadow: none;
    background-color: transparent;
    color: inherit;
  }

  &:active,
  &:focus-visible,
  &:focus-visible:hover {
    background-color: transparent;
    color: inherit;
  }

  &:not(.lg-btn) {
    &:focus-visible,
    &:focus-visible:hover {
      @include lg-focus-outline();
    }
  }
}

@mixin lg-font-size($size, $modifier: null, $type: null) {
  font-size: var(--font-size-#{$size});
  line-height: var(--line-height-#{$size});

  @if $type {
    font-family: var(--font-family-#{$type});
  }

  $weight: '400';

  @if $type == 'expressive' {
    $weight: '500';
  }

  @if $modifier {
    $weight: $modifier;
  }

  font-weight: var(--font-weight-#{$weight});
}

@mixin lg-visually-hidden {
  border: 0 !important;
  clip-path: inset(50%) !important;
  height: auto !important;
  margin: 0 !important;
  overflow: hidden !important;
  padding: 0 !important;
  position: absolute !important;
  width: 0.0625em !important;
  white-space: nowrap !important;
}

$breakpoints: (
  // 0
  'sm': 0,
  // 768
  'md': 48rem,
  // 1024
  'lg': 64rem,
  // 1280
  'xl': 80rem,
  // 1440
  'xxl': 90rem
) !default;

/*
  $breakpoint: string value for the breakpoint screen size.
  $range: 'min-width' or 'max-width' (legacy) or 'range'
  $max-breakpoint: optional - when $range is 'range', specify the max breakpoint name
  Creates a mixin which allows breakpoints to be added to css blocks
*/
@mixin lg-breakpoint($breakpoint, $range: 'min-width', $max-breakpoint: null) {
  @if map.has-key($breakpoints, $breakpoint) {
    $value: map.get($breakpoints, $breakpoint);

    @if $range == 'max-width' {
      // Removes 1 pixel if using max-width so that there is no
      // overlap when used with min-width.
      $value: $value - 0.06rem;

      @media ($range: $value) {
        @content;
      }
    } @else if $range == 'range' {
      // New range functionality - creates combined min and max media query
      @if $max-breakpoint and map.has-key($breakpoints, $max-breakpoint) {
        $max-value: map.get($breakpoints, $max-breakpoint) - 0.06rem;

        // Handle sm breakpoint (value 0) - only use max-width
        @if $value == 0 {
          @media (max-width: $max-value) {
            @content;
          }
        } @else {
          @media (min-width: $value) and (max-width: $max-value) {
            @content;
          }
        }
      } @else {
        @warn "Range mode requires a valid max-breakpoint. "
          + "Available breakpoints are: #{map.keys($breakpoints)}.";
      }
    } @else {
      // Default min-width behavior
      @media ($range: $value) {
        @content;
      }
    }
  } @else {
    @warn "Unfortunately, no value could be retrieved from `#{$breakpoint}`. "
      + "Available breakpoints are: #{map.keys($breakpoints)}.";
  }
}

// Mixin for components using subtle token names (Alert, Banner)
@mixin lg-status-subtle() {
  background-color: var(--container-status-subtle-background-colour);
  color: var(--text-status-subtle-primary-colour);

  a:not(.lg-btn) {
    @include lg-link(
      $default-color: var(--link-status-subtle-rest-colour),
      $hover-color: var(--link-status-subtle-hover-colour),
      $visited-color: var(--link-status-subtle-visited-colour),
      $active-color: var(--link-status-subtle-active-colour),
      $focus-color: var(--link-status-subtle-focus-colour),
      $focus-border-width: var(--link-status-subtle-focus-border-width),
      $focus-border-radius: var(--link-status-subtle-focus-border-radius)
    );
  }

  .lg-btn--primary,
  .lg-btn--secondary {
    background-color: var(--interactive-status-rest-background-colour) !important;
    border-color: var(--interactive-status-rest-border-colour) !important;
    color: var(--interactive-status-rest-colour) !important;

    &:hover {
      background-color: var(--interactive-status-hover-background-colour) !important;
      border-color: var(--interactive-status-hover-border-colour) !important;
      color: var(--interactive-status-hover-colour) !important;
    }

    &:active {
      background-color: var(--interactive-status-active-background-colour) !important;
      border-color: var(--interactive-status-active-border-colour) !important;
      color: var(--interactive-status-active-colour) !important;
    }

    &:focus-visible {
      background-color: var(--interactive-status-focus-background-colour) !important;
      border-color: var(--interactive-status-focus-colour) !important;
      color: var(--interactive-status-focus-colour) !important;
      box-shadow: 0 0 0 var(--interactive-border-width)
        var(--interactive-status-focus-background-colour) !important;
    }

    &:disabled {
      background-color: var(--interactive-status-disabled-background-colour) !important;
      border-color: var(--interactive-status-disabled-border-colour) !important;
      color: var(--interactive-status-disabled-colour) !important;
    }
  }
}

// Mixin for components using bold token names (Details, Validation)
@mixin lg-status-bold() {
  background-color: var(--container-status-bold-background-colour);
  color: var(--text-status-bold-primary-colour);

  a:not(.lg-btn) {
    @include lg-link(
      $default-color: var(--link-status-bold-rest-colour),
      $hover-color: var(--link-status-bold-hover-colour),
      $visited-color: var(--link-status-bold-visited-colour),
      $active-color: var(--link-status-bold-active-colour),
      $focus-color: var(--link-status-bold-focus-colour),
      $focus-border-width: var(--link-status-bold-focus-border-width),
      $focus-border-radius: var(--link-status-bold-focus-border-radius)
    );
  }

  .lg-btn--primary,
  .lg-btn--secondary {
    background-color: var(--interactive-status-rest-background-colour) !important;
    border-color: var(--interactive-status-rest-border-colour) !important;
    color: var(--interactive-status-rest-colour) !important;

    &:hover {
      background-color: var(--interactive-status-hover-background-colour) !important;
      border-color: var(--interactive-status-hover-border-colour) !important;
      color: var(--interactive-status-hover-colour) !important;
    }

    &:active {
      background-color: var(--interactive-status-active-background-colour) !important;
      border-color: var(--interactive-status-active-border-colour) !important;
      color: var(--interactive-status-active-colour) !important;
    }

    &:focus-visible {
      background-color: var(--interactive-status-focus-background-colour) !important;
      border-color: var(--interactive-status-focus-colour) !important;
      color: var(--interactive-status-focus-colour) !important;
      box-shadow: 0 0 0 var(--interactive-border-width)
        var(--interactive-status-focus-background-colour) !important;
    }

    &:disabled {
      background-color: var(--interactive-status-disabled-background-colour) !important;
      border-color: var(--interactive-status-disabled-border-colour) !important;
      color: var(--interactive-status-disabled-colour) !important;
    }
  }
}

@mixin lg-colour() {
  background-color: var(--container-default-background-colour) !important;
  color: var(--text-default-primary-colour) !important;

  a:not(.lg-btn) {
    @include lg-link(
      $default-color: var(--interactive-text-default-rest),
      $hover-color: var(--interactive-text-default-hover),
      $visited-color: var(--interactive-text-default-visited),
      $active-color: var(--interactive-text-default-active),
      $focus-color: var(--interactive-text-default-focus)
    );
  }

  .lg-btn--primary {
    background-color: var(--button-primary-rest-background-colour) !important;
    border: var(--button-border-width) solid var(--button-primary-rest-border-colour) !important;
    color: var(--button-primary-rest-colour) !important;
    border-radius: var(--button-border-radius);

    &:hover {
      border: var(--button-border-width) solid var(--button-primary-hover-border-colour) !important;
      color: var(--button-primary-hover-colour) !important;
      background-color: var(--button-primary-hover-background-colour) !important;
    }

    &:active {
      border: var(--button-border-width) solid var(--button-primary-active-border-colour) !important;
      background: var(--button-primary-active-background-colour) !important;
      color: var(--button-primary-active-colour) !important;
    }

    &:focus-visible {
      border: var(--button-border-width-focus) solid var(--button-primary-focus-colour) !important;
      background: var(--button-primary-focus-background-colour) !important;
      box-shadow: 0 0 0 var(--button-border-width)
        var(--button-primary-focus-background-colour) !important;
      color: var(--button-primary-focus-colour) !important;
    }

    &:disabled {
      border: var(--button-border-width) solid
        var(--button-primary-disabled-border-colour) !important;
      background: var(--button-primary-disabled-background-colour) !important;
      color: var(--button-primary-disabled-colour) !important;
    }
  }

  .lg-btn--secondary {
    border-radius: var(--button-border-radius) !important;
    border: var(--button-border-width) solid var(--button-secondary-rest-border-colour) !important;
    color: var(--button-secondary-rest-colour) !important;
    background-color: var(--button-secondary-rest-background-colour) !important;

    &:hover {
      border: var(--button-border-width) solid var(--button-secondary-hover-border-colour) !important;
      background: var(--button-secondary-hover-background-colour) !important;
      color: var(--button-secondary-hover-colour) !important;
    }

    &:active {
      border: var(--button-border-width) solid
        var(--button-secondary-active-border-colour) !important;
      background: var(--button-secondary-active-background-colour) !important;
      color: var(--button-secondary-active-colour) !important;
    }

    &:focus-visible {
      background-color: var(--button-secondary-focus-background-colour) !important;
      color: var(--button-secondary-focus-colour) !important;
      border: var(--button-border-width-focus) solid
        var(--button-secondary-focus-border-colour) !important;
      box-shadow: 0 0 0 var(--space-1) var(--button-secondary-focus-background-colour) !important;
    }

    &:disabled {
      color: var(--button-secondary-disabled-colour) !important;
      border: var(--button-border-width) solid
        var(--button-secondary-disabled-border-colour) !important;
      background-color: var(--button-secondary-disabled-background-colour) !important;
    }
  }
}

@mixin lg-card {
  background-color: var(--card-bg-color);
  border-radius: var(--container-border-radius-sm);
  margin-bottom: var(--grid-gutter);
  padding: var(--component-padding);

  @include lg-breakpoint('md') {
    border-radius: var(--container-border-radius-md);
  }
  @include lg-breakpoint('lg') {
    border-radius: var(--container-border-radius-lg);
  }
}

@mixin lg-typography-default {
  font-size: var(--text-base-size);
  font-weight: var(--font-weight-400-productive);
  font-family: var(--font-family);
  letter-spacing: var(--letter-spacing-normal-productive);
  line-height: var(--text-base-line-height);
  color: var(--text-default);
}

@mixin lg-paragraph {
  font-size: var(--font-size-1);
  margin-bottom: var(--text-bottom-margin);

  &:last-child {
    margin-bottom: 0;
  }
}

@mixin lg-list-margin {
  margin-left: var(--space-unit);
  margin-bottom: var(--text-bottom-margin);
}

@mixin lg-canopy-element-typography {
  html,
  body,
  input,
  select {
    @include lg-typography-default;
  }

  p {
    @include lg-paragraph;
  }

  a {
    @include lg-link;
  }

  b,
  strong {
    font-weight: var(--font-weight-700);
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    display: block;
    margin-bottom: var(--text-bottom-margin);
  }

  h1 {
    @include lg-font-size('5');
  }

  h2 {
    @include lg-font-size('4');
  }

  h3 {
    @include lg-font-size('3');
  }

  h4 {
    @include lg-font-size('2');
  }

  h5 {
    @include lg-font-size('1');
  }

  h6 {
    @include lg-font-size('0-8');
  }

  small {
    @include lg-font-size('0-6');
  }

  ul,
  ol {
    @include lg-list-margin;
  }
}

@mixin lg-nav-item() {
  appearance: none;
  box-shadow: none;
  border: 0;
  background: var(--nav-item-bg-color);
  color: var(--nav-item-color);
  cursor: pointer;
  text-decoration: none;
  margin-bottom: 0;
  line-height: 1.5;
  border-radius: var(--nav-item-border-radius);
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;

  &::after {
    content: '';
    position: absolute;
    height: 0.125rem;
    border-radius: var(--nav-item-border-radius);
    background-color: transparent;
    bottom: 0;
    left: 0.188rem;
    right: 0.188rem;
  }

  > .lg-icon {
    height: var(--nav-item-icon-height);
    width: auto;
  }

  &:focus-visible,
  &:hover:focus-visible {
    background-color: var(--nav-item-bg-color-hover);
    color: var(--nav-item-color-hover);

    &::after {
      background-color: var(--nav-item-border-color-hover);
    }

    @include lg-focus-outline(
      var(--default-focus-color),
      var(--default-inner-focus-color)
    );
  }

  &:hover,
  &:hover:visited {
    border: 0;
    background-color: var(--nav-item-bg-color-hover);
    color: var(--nav-item-color-hover);
    box-shadow: none;

    &::after {
      background-color: var(--nav-item-border-color-hover);
    }
  }

  &--active {
    border: 0;
    background-color: var(--nav-item-bg-color-active);

    &:visited::after,
    &:visited:hover::after,
    &:hover::after,
    &::after {
      background-color: var(--nav-item-border-color-active);
      height: 0.25rem;
      color: var(--nav-item-color-active);
    }

    &[type='button'],
    &[type='button']:hover,
    &[type='button']:hover:focus-visible {
      background-color: var(--nav-item-bg-color-expanded);
      color: var(--nav-item-color-expanded);

      .lg-notification-badge {
        color: var(--text-default);
        background-color: var(--nav-item-bg-color);
      }

      &::after {
        background-color: var(--nav-item-border-color-hover);
        height: 0.25rem;
      }
    }
  }
}
/* stylelint-enable nesting-selector-no-missing-scoping-root */
